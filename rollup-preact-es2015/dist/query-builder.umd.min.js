(function(a,b){'object'==typeof exports&&'undefined'!=typeof module?b():'function'==typeof define&&define.amd?define(b):b()})(this,function(){'use strict';function a(){}function b(b,c){var d,e,f,g,h=H;for(g=arguments.length;2<g--;)G.push(arguments[g]);for(c&&null!=c.children&&(!G.length&&G.push(c.children),delete c.children);G.length;)if((e=G.pop())&&void 0!==e.pop)for(g=e.length;g--;)G.push(e[g]);else'boolean'==typeof e&&(e=null),(f='function'!=typeof b)&&(null==e?e='':'number'==typeof e?e+='':'string'!=typeof e&&(f=!1)),f&&d?h[h.length-1]+=e:h===H?h=[e]:h.push(e),d=f;var i=new a;return i.nodeName=b,i.children=h,i.attributes=null==c?void 0:c,i.key=null==c?void 0:c.key,void 0!==F.vnode&&F.vnode(i),i}function c(a,b){for(var c in b)a[c]=b[c];return a}function d(a){!a._dirty&&(a._dirty=!0)&&1==K.push(a)&&(F.debounceRendering||I)(e)}function e(){var a,b=K;for(K=[];a=b.pop();)a._dirty&&y(a)}function f(a,b,c){return'string'==typeof b||'number'==typeof b?void 0!==a.splitText:'string'==typeof b.nodeName?!a._componentConstructor&&g(a,b.nodeName):c||a._componentConstructor===b.nodeName}function g(a,b){return a.normalizedNodeName===b||a.nodeName.toLowerCase()===b.toLowerCase()}function h(a){var b=c({},a.attributes);b.children=a.children;var d=a.nodeName.defaultProps;if(d!==void 0)for(var e in d)void 0===b[e]&&(b[e]=d[e]);return b}function j(a,b){var c=b?document.createElementNS('http://www.w3.org/2000/svg',a):document.createElement(a);return c.normalizedNodeName=a,c}function k(a){var b=a.parentNode;b&&b.removeChild(a)}function i(a,b,c,d,e){if('className'===b&&(b='class'),'key'===b);else if('ref'===b)c&&c(null),d&&d(a);else if('class'===b&&!e)a.className=d||'';else if('style'===b){if(d&&'string'!=typeof d&&'string'!=typeof c||(a.style.cssText=d||''),d&&'object'==typeof d){if('string'!=typeof c)for(var f in c)f in d||(a.style[f]='');for(var f in d)a.style[f]='number'==typeof d[f]&&!1===J.test(f)?d[f]+'px':d[f]}}else if('dangerouslySetInnerHTML'===b)d&&(a.innerHTML=d.__html||'');else if('o'==b[0]&&'n'==b[1]){var g=b!==(b=b.replace(/Capture$/,''));b=b.toLowerCase().substring(2),d?!c&&a.addEventListener(b,m,g):a.removeEventListener(b,m,g),(a._listeners||(a._listeners={}))[b]=d}else if('list'!==b&&'type'!==b&&!e&&b in a)l(a,b,null==d?'':d),(null==d||!1===d)&&a.removeAttribute(b);else{var h=e&&b!==(b=b.replace(/^xlink\:?/,''));null==d||!1===d?h?a.removeAttributeNS('http://www.w3.org/1999/xlink',b.toLowerCase()):a.removeAttribute(b):'function'!=typeof d&&(h?a.setAttributeNS('http://www.w3.org/1999/xlink',b.toLowerCase(),d):a.setAttribute(b,d))}}function l(a,b,c){try{a[b]=c}catch(a){}}function m(a){return this._listeners[a.type](F.event&&F.event(a)||a)}function n(){for(var a;a=L.pop();)F.afterMount&&F.afterMount(a),a.componentDidMount&&a.componentDidMount()}function o(a,b,c,d,e,f){M++||(N=null!=e&&void 0!==e.ownerSVGElement,O=null!=a&&!('__preactattr_'in a));var g=p(a,b,c,d,f);return e&&g.parentNode!==e&&e.appendChild(g),--M||(O=!1,!f&&n()),g}function p(b,c,d,e,f){var h=b,k=N;if((null==c||'boolean'==typeof c)&&(c=''),'string'==typeof c||'number'==typeof c)return b&&void 0!==b.splitText&&b.parentNode&&(!b._component||f)?b.nodeValue!=c&&(b.nodeValue=c):(h=document.createTextNode(c),b&&(b.parentNode&&b.parentNode.replaceChild(h,b),r(b,!0))),h.__preactattr_=!0,h;var l=c.nodeName;if('function'==typeof l)return z(b,c,d,e);if(N='svg'===l||'foreignObject'!==l&&N,l+='',(!b||!g(b,l))&&(h=j(l,N),b)){for(;b.firstChild;)h.appendChild(b.firstChild);b.parentNode&&b.parentNode.replaceChild(h,b),r(b,!0)}var m=h.firstChild,n=h.__preactattr_,o=c.children;if(null==n){n=h.__preactattr_={};for(var p=h.attributes,a=p.length;a--;)n[p[a].name]=p[a].value}return!O&&o&&1===o.length&&'string'==typeof o[0]&&null!=m&&void 0!==m.splitText&&null==m.nextSibling?m.nodeValue!=o[0]&&(m.nodeValue=o[0]):(o&&o.length||null!=m)&&q(h,o,d,e,O||null!=n.dangerouslySetInnerHTML),t(h,c.attributes,n),N=k,h}function q(a,b,d,e,g){var h,j,c,l,m,n=a.childNodes,o=[],q={},s=0,t=0,u=n.length,v=0,w=b?b.length:0;if(0!==u)for(var x=0;x<u;x++){var i=n[x],y=i.__preactattr_,z=w&&y?i._component?i._component.__key:y.key:null;null==z?(y||(void 0===i.splitText?g:!g||i.nodeValue.trim()))&&(o[v++]=i):(s++,q[z]=i)}if(0!==w)for(var x=0;x<w;x++){l=b[x],m=null;var z=l.key;if(null!=z)s&&void 0!==q[z]&&(m=q[z],q[z]=void 0,s--);else if(!m&&t<v)for(h=t;h<v;h++)if(void 0!==o[h]&&f(j=o[h],l,g)){m=j,o[h]=void 0,h===v-1&&v--,h===t&&t++;break}m=p(m,l,d,e),c=n[x],m&&m!==a&&m!==c&&(null==c?a.appendChild(m):m===c.nextSibling?k(c):a.insertBefore(m,c))}if(s)for(var x in q)void 0!==q[x]&&r(q[x],!1);for(;t<=v;)void 0!==(m=o[v--])&&r(m,!1)}function r(a,b){var c=a._component;c?A(c):(null!=a.__preactattr_&&a.__preactattr_.ref&&a.__preactattr_.ref(null),(!1===b||null==a.__preactattr_)&&k(a),s(a))}function s(a){for(a=a.lastChild;a;){var b=a.previousSibling;r(a,!0),a=b}}function t(a,b,c){for(var d in c)b&&null!=b[d]||null==c[d]||i(a,d,c[d],c[d]=void 0,N);for(d in b)'children'===d||'innerHTML'===d||d in c&&b[d]===('value'===d||'checked'===d?a[d]:c[d])||i(a,d,c[d],c[d]=b[d],N)}function u(a){var b=a.constructor.name;(P[b]||(P[b]=[])).push(a)}function v(a,b,c){var d,e=P[a.name];if(a.prototype&&a.prototype.render?(d=new a(b,c),B.call(d,b,c)):(d=new B(b,c),d.constructor=a,d.render=w),e)for(var f=e.length;f--;)if(e[f].constructor===a){d.nextBase=e[f].nextBase,e.splice(f,1);break}return d}function w(a,b,c){return this.constructor(a,c)}function x(a,b,c,e,f){a._disable||(a._disable=!0,(a.__ref=b.ref)&&delete b.ref,(a.__key=b.key)&&delete b.key,!a.base||f?a.componentWillMount&&a.componentWillMount():a.componentWillReceiveProps&&a.componentWillReceiveProps(b,e),e&&e!==a.context&&(!a.prevContext&&(a.prevContext=a.context),a.context=e),!a.prevProps&&(a.prevProps=a.props),a.props=b,a._disable=!1,0!==c&&(1!==c&&!1===F.syncComponentUpdates&&a.base?d(a):y(a,1,f)),a.__ref&&a.__ref(a))}function y(a,b,d,e){if(!a._disable){var f,g,i,j=a.props,k=a.state,l=a.context,m=a.prevProps||j,p=a.prevState||k,q=a.prevContext||l,s=a.base,u=a.nextBase,w=s||u,z=a._component,B=!1;if(s&&(a.props=m,a.state=p,a.context=q,2!==b&&a.shouldComponentUpdate&&!1===a.shouldComponentUpdate(j,k,l)?B=!0:a.componentWillUpdate&&a.componentWillUpdate(j,k,l),a.props=j,a.state=k,a.context=l),a.prevProps=a.prevState=a.prevContext=a.nextBase=null,a._dirty=!1,!B){f=a.render(j,k,l),a.getChildContext&&(l=c(c({},l),a.getChildContext()));var C,D,E=f&&f.nodeName;if('function'==typeof E){var G=h(f);g=z,g&&g.constructor===E&&G.key==g.__key?x(g,G,1,l,!1):(C=g,a._component=g=v(E,G,l),g.nextBase=g.nextBase||u,g._parentComponent=a,x(g,G,0,l,!1),y(g,1,d,!0)),D=g.base}else i=w,C=z,C&&(i=a._component=null),(w||1===b)&&(i&&(i._component=null),D=o(i,f,l,d||!s,w&&w.parentNode,!0));if(w&&D!==w&&g!==z){var H=w.parentNode;H&&D!==H&&(H.replaceChild(D,w),!C&&(w._component=null,r(w,!1)))}if(C&&A(C),a.base=D,D&&!e){for(var I=a,J=a;J=J._parentComponent;)(I=J).base=D;D._component=I,D._componentConstructor=I.constructor}}if(!s||d?L.unshift(a):!B&&(a.componentDidUpdate&&a.componentDidUpdate(m,p,q),F.afterUpdate&&F.afterUpdate(a)),null!=a._renderCallbacks)for(;a._renderCallbacks.length;)a._renderCallbacks.pop().call(a);M||e||n()}}function z(a,b,d,e){for(var f=a&&a._component,c=f,g=a,i=f&&a._componentConstructor===b.nodeName,j=i,k=h(b);f&&!j&&(f=f._parentComponent);)j=f.constructor===b.nodeName;return f&&j&&(!e||f._component)?(x(f,k,3,d,e),a=f.base):(c&&!i&&(A(c),a=g=null),f=v(b.nodeName,k,d),a&&!f.nextBase&&(f.nextBase=a,g=null),x(f,k,1,d,e),a=f.base,g&&a!==g&&(g._component=null,r(g,!1))),a}function A(a){F.beforeUnmount&&F.beforeUnmount(a);var b=a.base;a._disable=!0,a.componentWillUnmount&&a.componentWillUnmount(),a.base=null;var c=a._component;c?A(c):b&&(b.__preactattr_&&b.__preactattr_.ref&&b.__preactattr_.ref(null),a.nextBase=b,k(b),u(a),s(b)),a.__ref&&a.__ref(null)}function B(a,b){this._dirty=!0,this.context=b,this.props=a,this.state=this.state||{}}function C(a){const c=a.queries.map((c)=>b('span',{className:'query',key:c.id},c.combinator?`${c.combinator} `:'',c.attribute,' ',b('span',{className:'query-operator'},c.operator),' ',c.input,b('a',{className:'query-remove',href:'',onClick:(b)=>a.onClick(b,c.id)},'x')));return b('div',{className:'queries'},c)}function D(a){function c(c){switch(c){case'STRING':return b('input',{className:'filter-input',name:'selectedInput',onInput:a.handleInputChange});case'NUMBER':return b('input',{className:'filter-input',name:'selectedInput',type:'number',onInput:a.handleInputChange});case'DATE':return b('input',{className:'filter-input',name:'selectedInput',type:'date',onChange:a.handleInputChange});case'BOOLEAN':return b('select',{className:'filter-dropdown',name:'selectedInput',onChange:a.handleInputChange},b('option',{value:''}),b('option',{value:a.copy.filter.boolean.true.id},a.copy.filter.boolean.true.label),b('option',{value:a.copy.filter.boolean.false.id},a.copy.filter.boolean.false.label));case'ENUM':const d=a.enum.map((a)=>b('option',{key:a,value:a},a));return b('select',{className:'filter-dropdown',onChange:a.handleInputChange,multiple:!0,size:'1'},d);default:return null;}}let d;if(a.selectedAttribute){const b=a.selectedAttribute.split('_')[1];d=c(b)}return b('div',null,d)}function E(a){return b('div',{className:'panel'},b('h2',{className:'panel-heading'},a.copy.panel.heading),b(R,{entities:a.entities,attributes:a.attributes,operators:a.operators,enum:a.enum,combinators:a.combinators,copy:a.copy}))}var F={},G=[],H=[],I='function'==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout,J=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,K=[],L=[],M=0,N=!1,O=!1,P={};c(B.prototype,{setState:function(a,b){var e=this.state;this.prevState||(this.prevState=c({},e)),c(e,'function'==typeof a?a(e,this.props):a),b&&(this._renderCallbacks=this._renderCallbacks||[]).push(b),d(this)},forceUpdate:function(a){a&&(this._renderCallbacks=this._renderCallbacks||[]).push(a),y(this,2)},render:function(){}});const Q={ENDPOINT:'/data.json'};class R extends B{constructor(a){super(a),this.state={selectedOrganization:this.props.entities[0].id,selectedAttribute:'',selectedOperator:'',selectedInput:'',selectedCombinator:this.props.combinators[0],queries:[],attributes:this.props.attributes.reduce((a,b)=>{const c=Object.keys(b)[0];return a[c]=b[c],a},{}),operators:Object.keys(this.props.operators).map((a)=>({id:a,label:this.props.operators[a]}))},this.handleInputChange=this.handleInputChange.bind(this),this.handleAddQuery=this.handleAddQuery.bind(this),this.handleRemoveQuery=this.handleRemoveQuery.bind(this),this.handleReset=this.handleReset.bind(this)}handleInputChange(a){const b=a.target.name;this.setState({[b]:a.target.value})}handleAddQuery(a){const b=[...this.state.queries],c={id:this.state.queries.length,attribute:this.state.selectedAttribute,operator:this.state.selectedOperator,input:this.state.selectedInput};0<b.length&&(c.combinator=this.state.selectedCombinator),b.push(c),this.setState({queries:b}),this.handleReset(a)}handleRemoveQuery(a,b){a.preventDefault();const c=this.state.queries.filter((a)=>a.id!==b);this.setState({queries:c})}handleReset(a){a.preventDefault(),this.setState({selectedAttribute:'',selectedOperator:'',selectedInput:''})}render(){const a=this.props.entities.map((a)=>b('option',{key:a.id,value:a.id},a.label)),c=this.state.attributes[this.state.selectedOrganization].map((a)=>b('option',{key:a,value:a},a)),d=this.state.operators.map((a)=>b('option',{key:a.id,value:a.id},a.label)),e=this.props.combinators.map((a)=>b('option',{key:a,value:a},a)),f=this.state.selectedOrganization&&this.state.selectedAttribute&&this.state.selectedOperator&&this.state.selectedInput;return b('form',{className:'filter-form'},b('div',{className:'primary-content'},b('select',{className:'filter-dropdown',name:'selectedOrganization',value:this.state.selectedOrganization,onChange:this.handleInputChange},a),b(C,{queries:this.state.queries,onClick:this.handleRemoveQuery})),b('div',{className:'secondary-content'},0<this.state.queries.length&&b('select',{className:'filter-dropdown',name:'selectedCombinator',value:this.state.selectedCombinator,onChange:this.handleInputChange},e),b('select',{className:'filter-dropdown',name:'selectedAttribute',value:this.state.selectedAttribute,onChange:this.handleInputChange},b('option',{value:'',disabled:!0,hidden:!0},this.props.copy.filter.attributePlaceholder),c),this.state.selectedAttribute&&b('select',{className:'filter-dropdown',name:'selectedOperator',value:this.state.selectedOperator,onChange:this.handleInputChange},b('option',{value:'',disabled:!0,hidden:!0},this.props.copy.filter.operatorPlaceholder),d),b(D,{selectedAttribute:this.state.selectedAttribute,copy:this.props.copy,handleInputChange:this.handleInputChange}),b('div',{className:'filter-icons'},f&&b('a',{className:'filter-plus',href:'',onClick:this.handleAddQuery},'+'),this.state.selectedAttribute&&b('a',{className:'filter-minus',href:'',onClick:this.handleReset},'-'))))}}(function(a,b){if('undefined'==typeof document)return b;a=a||'';var c=document.head||document.getElementsByTagName('head')[0],d=document.createElement('style');return d.type='text/css',c.appendChild(d),d.styleSheet?d.styleSheet.cssText=a:d.appendChild(document.createTextNode(a)),b})('*{box-sizing:border-box}html{font-size:calc(10px + 14 * (100vw - 320px) / 1600)}body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;margin:0;padding:2rem 3rem}.query-builder{margin:0 auto;max-width:1024px}.panel{border:2px solid #000}.panel-heading{background:#000;color:#fff;font-size:1rem;font-weight:400;margin:0;padding:.3em .5em .4em}.filter-form{padding:.8rem}.primary-content{display:flex}.secondary-content{align-items:center;display:flex;margin-top:.8rem}.filter-dropdown,.filter-input{border:1px solid #a9a9a9;border-radius:.2rem;display:flex;margin-right:.8rem;padding:.2rem}.filter-icons{display:flex}.filter-minus,.filter-plus,.query-remove{align-items:center;color:#fff;display:flex;font-family:monospace;font-size:1.2rem;height:1.3rem;justify-content:center;text-decoration:none;width:1.3rem}.filter-plus{background:#4caf50;margin-right:.8rem}.filter-minus{background:red}.query-remove{color:#000;display:inline;margin-left:.8rem;font-weight:700}.queries{display:flex}.queries span:last-child{border-right:0}.query{border-right:1px solid #a9a9a9;padding:0 .8rem}.query-operator{color:#2196f3}',void 0);(function(a,b,c){return o(c,a,{},!1,b,!1)})(b(class extends B{constructor(){super(),this.state={data:null}}componentDidMount(){fetch(Q.ENDPOINT).then((a)=>a.json()).then((a)=>this.setState({data:a}))}render(){const a=this.state.data?b(E,{entities:this.state.data.entity,attributes:this.state.data.attribute,operators:this.state.data.operator,enum:this.state.data.enum,combinators:this.state.data.combinator,copy:this.state.data.copy}):null;return b('main',{className:'query-builder'},b('h1',null,'Query Builder'),a)}},null),document.getElementById('app'))});
